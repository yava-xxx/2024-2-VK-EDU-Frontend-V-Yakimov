(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))u(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&u(p)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const E=[{id:1,text:"Привет! Как дела???",sentOrReceived:"received",status:"",timestamp:"10:00",senderName:"Иван Иванов",isDefault:!0},{id:0,text:"Ты сделал домашку по VK Frontend?????",sentOrReceived:"received",status:"",timestamp:"10:05",senderName:"Иван Иванов",isDefault:!0}];document.addEventListener("DOMContentLoaded",function(){const l=document.getElementById("messages"),m=document.getElementById("messageForm"),s=document.getElementById("messageInput"),u=(e,t,d)=>{const c={id:y(),text:e,sentOrReceived:t,status:d,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),senderName:t==="sent"?"Вы":"Иван Иванов"},r=()=>{const a=v(c);l.appendChild(a),l.scrollTop=l.scrollHeight},i=()=>{const a=localStorage.getItem("messages"),f=a?JSON.parse(a):[];f.push(c),localStorage.setItem("messages",JSON.stringify(f))};r(),i()},n=e=>{const t=document.getElementById(e);t.classList.add("destroy"),setTimeout(()=>{t.remove();const d=document.querySelectorAll(".message"),c=[];d.forEach(r=>{const i={id:r.id,senderName:r.querySelector(".sender-name").textContent,text:r.querySelector(".message-text").innerHTML,timestamp:r.querySelector(".timestamp").textContent,status:r.querySelector(".message-status-icon").textContent,sentOrReceived:r.classList.contains("sent")?"sent":"received"};c.push(i)}),localStorage.setItem("messages",JSON.stringify(c))},500)},o=()=>{const e=h(p());e.push(...E),l.innerHTML="",e.forEach(t=>{u(t.text,t.sentOrReceived,t.status)}),l.scrollTop=l.scrollHeight,localStorage.setItem("messages",JSON.stringify(e))},p=()=>{const e=localStorage.getItem("messages");return e?JSON.parse(e):[]},h=e=>e.map(t=>({id:t.id,senderName:t.senderName,text:t.text,timestamp:t.timestamp,status:t.status,sentOrReceived:t.sentOrReceived})),y=()=>Math.floor(Math.random()*1e6).toString(),g=e=>{const t=e.value.trim().replace(/</g,"&lt;").replace(/^\s*\n+|\n+\s*$/g,"").replace(/\n+/g,`
`);t&&(u(t,"sent","read"),e.value="",e.style.height="5vh",e.style.overflowY="hidden",e.setSelectionRange(0,0))},v=e=>{const t=document.createElement("li");t.id=e.id,t.classList.add("message",e.sentOrReceived);const d=document.createElement("span");d.classList.add("sender-name"),d.textContent=e.senderName,t.appendChild(d);const c=document.createElement("span");c.classList.add("message-text"),c.innerHTML=e.text.replace(/\n/g,"<br>"),t.appendChild(c);const r=document.createElement("span");r.classList.add("timestamp"),r.textContent=e.timestamp,t.appendChild(r);const i=document.createElement("i");i.classList.add("material-icons","message-status-icon"),e.status==="check"?i.textContent="check":i.textContent="done_all",t.appendChild(i);const a=document.createElement("button");return a.classList.add("delete-button"),a.innerHTML='<i class="material-icons">delete</i>',t.appendChild(a),e.id==="1"||e.id==="0"?a.style.display="none":a.addEventListener("click",()=>{n(e.id)}),t};o(),m.addEventListener("submit",e=>{e.preventDefault(),g(s),s.dispatchEvent(new Event("input")),s.scrollTop=s.scrollHeight}),s.addEventListener("keydown",e=>{if(e.key==="Enter"){if(e.preventDefault(),e.shiftKey){const t=s.selectionStart;s.value=s.value.slice(0,t)+`
`+s.value.slice(t),s.selectionStart=s.selectionEnd=t+1}else g(s);s.dispatchEvent(new Event("input")),s.scrollTop=s.scrollHeight}}),s.addEventListener("input",()=>{const e=s;e.style.height="auto",e.style.minHeight="5vh",e.style.height=e.scrollHeight+"px",e.style.overflowY="auto"})});
