(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();class h{constructor(e){this.key=e}save(e){localStorage.setItem(this.key,JSON.stringify(e))}load(){const e=localStorage.getItem(this.key);return e?JSON.parse(e):null}}class u{constructor(){this.users={},this.storageManager=new h("userData"),this.loadFromLocalStorage()}addUser({lastName:e,firstName:t,patronymic:s,nickname:a,password:r,about:i}){const l=(Object.keys(this.users).length+1).toString();this.users[l]={id:l,lastName:e,firstName:t,patronymic:s,nickname:a,password:r,about:i},this.saveToLocalStorage()}getUser(e){return this.users[e]}getAllUsers(){return Object.values(this.users)}saveToLocalStorage(){this.storageManager.save(this.users)}loadFromLocalStorage(){const e=this.storageManager.load();e&&(this.users=e)}getUserByNickname(e){for(const t in this.users)if(this.users[t].nickname===e)return this.users[t];return null}}const g=[{lastName:"Иванов",firstName:"Иван",patronymic:"Иванович",nickname:"ivan_ivanov",password:"password123",about:"Hello, I am Ivan!"},{lastName:"Петров",firstName:"Петр",patronymic:"Петрович",nickname:"petr_petrov",password:"password456",about:"Hello, I am Petr!"},{lastName:"Баранников",firstName:"Роман",patronymic:"Романович",nickname:"rbarannikov",password:"roman",about:"Hello, I am Roma!"}];let n;localStorage.getItem("userData")?(n=new u,n.loadFromLocalStorage()):(n=new u,g.forEach(o=>{n.addUser(o)}));class d{constructor(){this.chats=[],this.storageManager=new h("chatData"),this.loadFromLocalStorage()}addChat(){const t={id:(this.chats.length+1).toString(),title:"",messages:[],users:[]};return this.chats.push(t),t}getChat(e){return this.chats.find(t=>t.id===e)||null}addMessage(e,t){const s=this.getChat(e);s&&s.messages.push(t)}setTitle(e,t){const s=this.getChat(e);s&&(s.title=t)}addUser(e,t){const s=this.getChat(e);s&&s.users.push(t)}getChatsForUser(e){return this.chats.filter(t=>t.users.includes(Number(e)))}saveToLocalStorage(){this.storageManager.save(this.chats)}loadFromLocalStorage(){const e=this.storageManager.load();e&&(this.chats=e)}}new d;const m=[{id:1,messages:[{id:1,text:"Привет!",sentOrReceived:"sent",status:"read",date:"2022-07-25",timestamp:"12:00:00",senderName:"Вы",userId:1,chatId:1},{id:2,text:"Привет!",sentOrReceived:"received",status:"read",date:"2022-07-25",timestamp:"12:01:00",senderName:"Иван Иванов",userId:2,chatId:1}],users:[1,2]},{id:2,messages:[{id:1,text:"Привет!",status:"read",date:"2022-07-25",timestamp:"12:00:00",userId:3,chatId:2},{id:2,text:"Здравствуй!",status:"sent",date:"2022-07-25",timestamp:"12:01:00",userId:1,chatId:2}],users:[1,3]}],f=o=>{console.log("Initialized ChatData"),m.forEach(e=>{let t=o.getChat(e.id)||o.addChat();e.users.forEach(s=>{o.addUser(t.id,s)}),e.messages.forEach(s=>{o.addMessage(t.id,s)})}),o.saveToLocalStorage()};let c=new d;localStorage.getItem("chatData")?(c=new d,c.loadFromLocalStorage()):f(c);export{c,n as u};
