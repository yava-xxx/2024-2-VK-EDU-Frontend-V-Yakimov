(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();class u{constructor(){this.users={},this.loadFromLocalStorage()}addUser(e,t,s,a,r,d,m){this.users[e]={id:e,lastName:t,firstName:s,patronymic:a,nickname:r,password:d,about:m},this.saveToLocalStorage()}getUser(e){return this.users[e]}getAllUsers(){return Object.values(this.users)}saveToLocalStorage(){localStorage.setItem("userData",JSON.stringify(this.users))}loadFromLocalStorage(){const e=localStorage.getItem("userData");e&&(this.users=JSON.parse(e))}getUserByNickname(e){for(const t in this.users)if(this.users[t].nickname===e)return this.users[t];return null}}let o;localStorage.getItem("userData")?(o=new u,o.loadFromLocalStorage()):(o=new u,o.addUser("1","Иванов","Иван","Иванович","ivan_ivanov","password123","Hello, I am Ivan!"),o.addUser("2","Петров","Петр","Петрович","petr_petrov","password456","Hello, I am Petr!"),o.addUser("3","Баранников","Роман","Романович","rbarannikov","roman","Hello, I am Roma!"));class l{constructor(){this.chats=[],this.loadFromLocalStorage()}addChat(e){const t={id:e,title:"",messages:[],users:[]};return this.chats.push(t),t}getChat(e){return this.chats.find(t=>t.id===e)||null}addMessage(e,t){const s=this.getChat(e);s&&s.messages.push(t)}setTitle(e,t){const s=this.getChat(e);s&&(s.title=t)}addUser(e,t){const s=this.getChat(e);s&&s.users.push(t)}saveToLocalStorage(){localStorage.setItem("chatData",JSON.stringify(this.chats))}loadFromLocalStorage(){const e=localStorage.getItem("chatData");e?this.chats=JSON.parse(e):this.chats=[]}}new l;let i;localStorage.getItem("chatData")?(i=new l,i.loadFromLocalStorage()):(i=new l,[{id:1,messages:[{id:1,text:"Привет!",sentOrReceived:"sent",status:"read",date:"2022-07-25",timestamp:"12:00:00",senderName:"Вы",userId:1,chatId:1},{id:2,text:"Привет!",sentOrReceived:"received",status:"read",date:"2022-07-25",timestamp:"12:01:00",senderName:"Иван Иванов",userId:2,chatId:1}],users:[1,2]},{id:2,messages:[{id:1,text:"Привет!",status:"read",date:"2022-07-25",timestamp:"12:00:00",userId:3,chatId:2},{id:2,text:"Здравствуй!",status:"sent",date:"2022-07-25",timestamp:"12:01:00",userId:1,chatId:2}],users:[1,3]}].forEach(e=>{i.addChat(e.id),e.users.forEach(t=>{i.addUser(e.id,t)}),e.messages.forEach(t=>{i.addMessage(e.id,t)})}));i.saveToLocalStorage();o.loadFromLocalStorage();i.loadFromLocalStorage();const h=document.getElementById("login-form"),n=document.getElementById("error-message");h.addEventListener("submit",c=>{c.preventDefault();const e=document.getElementById("nickname").value,t=document.getElementById("password").value,s=o.getUserByNickname(e);s&&s.password===t?(localStorage.setItem("currentUserId",s.id),window.location.href="messages_page/messenger.html"):(n.textContent="Такого пользователя нет в базе!",n.style.opacity=1,setTimeout(()=>{n.style.opacity=0},3e3))});
