import{c as n,u as h}from"./chats-3Lt7tHit.js";import{G as S}from"./utils-YGOX322K.js";document.addEventListener("DOMContentLoaded",function(){const o=document.getElementById("messages"),E=document.getElementById("messageForm"),s=document.getElementById("messageInput");n.loadFromLocalStorage(),h.loadFromLocalStorage();let c=parseInt(window.location.search.split("?chatId=")[1]),r=parseInt(localStorage.getItem("currentUserId")),v=n.getChat(c);const L=document.getElementById("partner-name");L.textContent=S(v);const C=(e,t)=>{const a={id:y(),text:e,status:t,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),userId:r,chatId:c};n.addMessage(c,a),n.getChat(c);const l=p(a);o.appendChild(l),o.scrollTop=o.scrollHeight,n.saveToLocalStorage(),console.log(localStorage.getItem("chatData"))},f=e=>{const t=document.getElementById(e);t.classList.add("destroy"),setTimeout(()=>{t.remove();const a=n.getChat(c);a.messages=a.messages.filter(l=>l.id!==e),n.saveToLocalStorage()},500)},I=()=>{const e=n.getChat(c);e&&(o.innerHTML="",e.messages.forEach(t=>{t.userId!==r&&(t.status==="check"||t.status==="sent")&&(t.status="read");const a=p(t);o.appendChild(a)}),o.scrollTop=o.scrollHeight,n.saveToLocalStorage())},y=()=>Math.floor(Math.random()*1e6).toString(),g=e=>{const t=e.value.trim().replace(/</g,"<").replace(/>/g,">").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");t&&(C(t,"sent"),e.value="",e.style.height="5vh",e.style.overflowY="hidden",e.setSelectionRange(0,0))},p=e=>{const t=document.createElement("li");t.id=e.id,t.classList.add("message",r===e.userId?"sent":"received");const a=document.createElement("span");a.classList.add("sender-name");const l=h.getUser(e.userId);l?a.textContent=r===e.userId?"Вы":l.lastName+" "+l.firstName:a.textContent="Пользователь не найден",t.appendChild(a);const m=document.createElement("span");m.classList.add("message-text"),m.innerHTML=e.text.replace(/\n/g,"<br>"),t.appendChild(m);const u=document.createElement("span");u.classList.add("timestamp"),u.textContent=e.timestamp,t.appendChild(u);const d=document.createElement("i");d.classList.add("material-icons","message-status-icon"),e.status==="read"?d.textContent="done_all":d.textContent="done",t.appendChild(d);const i=document.createElement("button");return i.classList.add("delete-button"),i.innerHTML='<i class="material-icons">delete</i>',t.appendChild(i),i.addEventListener("click",()=>{f(e.id)}),t};I(),E.addEventListener("submit",e=>{e.preventDefault(),g(s),s.dispatchEvent(new Event("input")),s.scrollTop=s.scrollHeight}),s.addEventListener("keydown",e=>{if(e.key==="Enter"){if(e.preventDefault(),e.shiftKey){const t=s.selectionStart;s.value=s.value,s.value=s.value.slice(0,t)+`
`+s.value.slice(t),s.selectionStart=s.selectionEnd=t+1}else g(s);s.dispatchEvent(new Event("input")),s.scrollTop=s.scrollHeight}}),s.addEventListener("input",()=>{const e=s;e.style.height="auto",e.style.minHeight="5vh",e.style.height=e.scrollHeight+"px",e.style.overflowY="auto"})});
